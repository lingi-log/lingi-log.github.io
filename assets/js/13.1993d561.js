(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{212:function(t,_,v){"use strict";v.r(_);var e=v(0),i=Object(e.a)({},(function(){var t=this,_=t.$createElement,v=t._self._c||_;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"성능-최적화"}},[t._v("성능 최적화")]),t._v(" "),v("blockquote",[v("h3",{attrs:{id:"테스트-서버-스펙"}},[t._v("테스트 서버 스펙")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th"),t._v(" "),v("th")])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("cpu")]),t._v(" "),v("td",[t._v("12코어(6코어 * 2)")])]),t._v(" "),v("tr",[v("td",[t._v("메모리")]),t._v(" "),v("td",[t._v("32GB")])]),t._v(" "),v("tr",[v("td",[t._v("서버")]),t._v(" "),v("td",[t._v("2대")])])])])]),t._v(" "),v("h2",{attrs:{id:"테스트-요소"}},[t._v("테스트 요소")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("인덱싱 성능")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th"),t._v(" "),v("th")])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("테스트 목적")]),t._v(" "),v("td",[t._v("실시간으로 들어오는 대량의 데이터를 밀리거나 누락되지 않고 처리할 수 있는 지 확인"),v("br"),t._v("현 서버 기준 최적의 shard개수, 인댁스 매핑 찾기")])]),t._v(" "),v("tr",[v("td",[t._v("통과 기준")]),t._v(" "),v("td",[t._v("이상(에러 등) 없이 document가 인덱싱 되는 지 테스트"),v("br"),t._v("집어넣은 데이터가 누락 없이 인덱싱 되었는 지 RDB와 비교")])]),t._v(" "),v("tr",[v("td",[t._v("테스트 계획")]),t._v(" "),v("td",[t._v("1. Document 생성 방법: RDB -> (Logstash) -> ES"),v("br"),t._v("2. Document 개수 : 3000개/분 * 1시간"),v("br"),t._v("3. 테스트 통과 시 측정 시간을 하루, 일주일로 늘려가며 테스트 한 후, 최종 테스트 결과 판별")])])])])]),t._v(" "),v("li",[v("p",[t._v("쿼리 속도")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th"),t._v(" "),v("th")])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("테스트 목적")]),t._v(" "),v("td",[t._v("인덱싱된 데이터로 RDB와 동일한 결과를 뽑아내는 데 어느 정도의 시간이 걸리는 지 측정"),v("br"),t._v("현 서버 기준 최적의 shard개수, 인댁스 매핑 찾기")])]),t._v(" "),v("tr",[v("td",[t._v("통과 기준")]),t._v(" "),v("td",[t._v("RDB보다 빠른 시간"),v("br"),t._v("쿼리 처리 속도 1초 이내 목표")])]),t._v(" "),v("tr",[v("td",[t._v("테스트 계획")]),t._v(" "),v("td",[t._v("Document 생성 방법 : 기존 사용하고 있는 데이터들 logstash 사용하여 ES로 집어넣기"),v("br"),t._v("RDB의 쿼리와 같은 결과물을 얻는 ES 쿼리를 작성 후 속도를 측정해 본다.")])])])])])]),t._v(" "),v("h2",{attrs:{id:"성능-테스트"}},[t._v("성능 테스트")]),t._v(" "),v("h3",{attrs:{id:"_1-인덱싱-성능"}},[t._v("1. 인덱싱 성능")]),t._v(" "),v("h4",{attrs:{id:"인덱싱-성능-테스트-1차"}},[t._v("인덱싱 성능 테스트 1차")]),t._v(" "),v("h5",{attrs:{id:"준비"}},[t._v("준비")]),t._v(" "),v("ol",[v("li",[t._v("mariadb -> elasticsearch 데이터 동기화\n"),v("ul",[v("li",[t._v("logstash 10개 pipeline 설정")]),t._v(" "),v("li",[t._v("scheduler 1분")]),t._v(" "),v("li",[t._v("pipeline 하나당 1분에 300개, 총 1분에 3000개 데이터 들어감.")])])])]),t._v(" "),v("h5",{attrs:{id:"결과"}},[t._v("결과")]),t._v(" "),v("ul",[v("li",[v("code",[t._v("retrying failed action with response code: 429")]),t._v("에러 발생.\n"),v("ul",[v("li",[t._v("인덱싱 성능 향상을 위한 튜닝 필요")])])])]),t._v(" "),v("blockquote",[v("h4",{attrs:{id:"인덱싱-성능-튜닝-방법"}},[t._v("인덱싱 성능 튜닝 방법.")]),t._v(" "),v("ol",[v("li",[t._v("_all 필드 비활성화\n"),v("ul",[v("li",[t._v("특별한 목적에 의해 ES가 생성하는 필드.")])])]),t._v(" "),v("li",[t._v("static index 사용해보기.\n"),v("ul",[v("li",[t._v("text 필드가 keyword 필드로 많이 바뀔 수록 그 차이는 더 크게 날 것임.")])]),t._v(" "),v("ol",[v("li",[t._v("text -> keyword, log -> integer로 변경")])])]),t._v(" "),v("li",[t._v("refresh_interval\n"),v("ul",[v("li",[t._v("es는 새로운 문서가 인입되었을 때 인덱싱을 하고 그 결과를 세그먼트 단위로 저장함.")]),t._v(" "),v("li",[t._v("이 세그먼트들은 백그라운드에서 머지되어 점점 큰 세그먼트가 되어가는데, es가 이 작업을 하는 것을 refresh라고 부름.")]),t._v(" "),v("li",[t._v("이 세그먼트 생성 주기는 default 1초. (near realtime search engine 컨셉)")]),t._v(" "),v("li",[t._v("이 작업은 성능에 영향을 준다. 1초에서 더 늘리면 더 많은 양의 데이터를 인덱싱 할 수 있음.")])])]),t._v(" "),v("li",[t._v("primary shard 개수\n"),v("ul",[v("li",[t._v("모든 인덱싱은 primary shard에서 일어남. 따라서, primary shard의 개수에 따라 인덱싱 성능이 달라질 수 있음.")])])]),t._v(" "),v("li",[t._v("필드 개수 줄이기\n"),v("ul",[v("li",[t._v("insp_type_value 부분을 object => array 형식으로 변경하여 필드 개수 줄임.(약 1000개 정도?)")]),t._v(" "),v("li",[v("code",[t._v("mapping_nested_nested_0812.json")])])])])])]),t._v(" "),v("h4",{attrs:{id:"인덱싱-성능-테스트-2차"}},[t._v("인덱싱 성능 테스트 2차")]),t._v(" "),v("h5",{attrs:{id:"준비-2"}},[t._v("준비")]),t._v(" "),v("ul",[v("li",[t._v("_all 필드 비활성화")]),t._v(" "),v("li",[t._v("static index 사용\n"),v("ul",[v("li",[t._v("데이터 집어넣기 전에 매핑")]),t._v(" "),v("li",[t._v("문자열 형식 필드는 keyword로, 숫자 필드는 integer로 변경")])])]),t._v(" "),v("li",[t._v("refresh interval은 세팅 안함..")]),t._v(" "),v("li",[t._v("primary shard 변경해가며 속도 비교")]),t._v(" "),v("li",[t._v("데이터 형식 보고 필드 개수 줄임\n"),v("ul",[v("li",[t._v("필요하지 않은 필드 제거, object array는 nested 형식으로 변경. 1500개 -> 60개로 축소")])])])]),t._v(" "),v("h5",{attrs:{id:"테스트"}},[t._v("테스트")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("shard 별 indexing 시간(mapping은 기존)")]),t._v(" "),v("blockquote",[v("p",[t._v("all 필드 disable"),v("br"),t._v("\nmapping 직접 정의해 keyword 필드, integer로 설정.")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("-")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("2 Shard, 1 Replica")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("4 Shard, 1 Replica")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("6 Shard, 1 Replica")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("8 Shard, 1 Replica")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("10 Shard, 1 Replica")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("12 Shard, 1 Replica")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("5000개")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("2234"),v("br"),t._v("2190")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("1398"),v("br"),t._v("1506")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("2080"),v("br"),t._v("2760")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("3059"),v("br"),t._v("11176")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("6968"),v("br"),t._v("8332")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("8294"),v("br"),t._v("14363")])]),t._v(" "),v("tr",[v("td",[t._v("10000개")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("4236"),v("br"),t._v("4153")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("4776"),v("br"),t._v("2539")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("6479"),v("br"),t._v("8874")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("7312"),v("br"),t._v("6790")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("13072"),v("br"),t._v("11108")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("14600"),v("br"),t._v("17498")])])])]),t._v(" "),v("p",[t._v("=> 4shard 1 replica가 가장 우수함.")])]),t._v(" "),v("li",[v("p",[t._v("mapping 변경 indexing 시간")]),t._v(" "),v("blockquote",[v("p",[t._v("all 필드 disable"),v("br"),t._v("\nmapping 직접 정의해 keyword 필드, integer로 설정."),v("br"),t._v("\nmapping 구조 변경으로 필드 1299개 줄임(1351 -> 52)")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("-")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("2 Shard, 1 Replica")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("4 Shard, 1 Replica")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("6 Shard, 1 Replica")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("8 Shard, 1 Replica")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("10 Shard, 1 Replica")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("12 Shard, 1 Replica")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("5000개")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}}),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("900"),v("br"),t._v("882")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}}),t._v(" "),v("td",{staticStyle:{"text-align":"center"}}),t._v(" "),v("td",{staticStyle:{"text-align":"center"}}),t._v(" "),v("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),v("tr",[v("td",[t._v("10000개")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}}),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("1796"),v("br"),t._v("1705")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}}),t._v(" "),v("td",{staticStyle:{"text-align":"center"}}),t._v(" "),v("td",{staticStyle:{"text-align":"center"}}),t._v(" "),v("td",{staticStyle:{"text-align":"center"}})])])])])]),t._v(" "),v("h6",{attrs:{id:"결론"}},[t._v("결론")]),t._v(" "),v("ul",[v("li",[t._v("현재 상황(서버 스펙, 2대 클러스터 구성)에서 인덱싱 성능은 4shard 4 replica가 가장 우수함.\n"),v("ul",[v("li",[t._v("인터넷 검색을 해보면 코어 하나당 샤드 하나 배치 하는 것이 좋다고 하는데, 6샤드 1레플리카(총 12개 샤드)는 성능이 4s 1r 보다 성능이 떨어짐.")])])]),t._v(" "),v("li",[t._v("사용하는 데이터의 특성 상 긴 텍스트가 없어서 그런지 text -> keyword, long -> integer로 변경한게 인덱싱 시간에 큰 영향을 주진 않는 것 같음(줄어들긴 함. 데이터 기록을 못했다 ㅠ)")]),t._v(" "),v("li",[t._v("필드의 개수를 줄이면 확실히 인덱싱 시간이 줄어든다!")])]),t._v(" "),v("h3",{attrs:{id:"_2-쿼리-속도-테스트"}},[t._v("2. 쿼리 속도 테스트")]),t._v(" "),v("h4",{attrs:{id:"쿼리-속도-테스트-1차"}},[t._v("쿼리 속도 테스트 1차")]),t._v(" "),v("h5",{attrs:{id:"준비-3"}},[t._v("준비")]),t._v(" "),v("ul",[v("li",[t._v("worst top five 해당하는 es 쿼리 작성")]),t._v(" "),v("li",[t._v("item list 해당하는 es 쿼리 작성")])]),t._v(" "),v("h5",{attrs:{id:"테스트-2"}},[t._v("테스트")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("worst top five")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("idx")]),t._v(" "),v("th",[t._v("xx")]),t._v(" "),v("th",[t._v("xx")]),t._v(" "),v("th",[t._v("xx 개수")]),t._v(" "),v("th",[t._v("xx 개수")]),t._v(" "),v("th",[t._v("date")]),t._v(" "),v("th",[t._v("db")]),t._v(" "),v("th",[t._v("elasticsearch")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("1")]),t._v(" "),v("td",[t._v("1034")]),t._v(" "),v("td",[t._v("989")]),t._v(" "),v("td",[t._v("18")]),t._v(" "),v("td",[t._v("5184")]),t._v(" "),v("td",[t._v("최근 1시간")]),t._v(" "),v("td",[t._v("2ms")]),t._v(" "),v("td",[t._v("8ms")])]),t._v(" "),v("tr",[v("td",[t._v("2")]),t._v(" "),v("td",[t._v("전체")]),t._v(" "),v("td",[t._v("전체")]),t._v(" "),v("td",[t._v("-")]),t._v(" "),v("td",[t._v("-")]),t._v(" "),v("td",[t._v("최근 3개월 15일")]),t._v(" "),v("td",[t._v("3분이상")]),t._v(" "),v("td",[t._v("192m")])])])])]),t._v(" "),v("li",[v("p",[t._v("item list")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("idx")]),t._v(" "),v("th",[t._v("xx")]),t._v(" "),v("th",[t._v("xx")]),t._v(" "),v("th",[t._v("xx 개수")]),t._v(" "),v("th",[t._v("xx 개수")]),t._v(" "),v("th",[t._v("date")]),t._v(" "),v("th",[t._v("db")]),t._v(" "),v("th",[t._v("elasticsearch")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("1")]),t._v(" "),v("td",[t._v("1034")]),t._v(" "),v("td",[t._v("989")]),t._v(" "),v("td",[t._v("18")]),t._v(" "),v("td",[t._v("5184")]),t._v(" "),v("td",[t._v("최근 1시간")]),t._v(" "),v("td",[t._v("2ms")]),t._v(" "),v("td",[t._v("3ms")])]),t._v(" "),v("tr",[v("td",[t._v("2")]),t._v(" "),v("td",[t._v("1034")]),t._v(" "),v("td",[t._v("989")]),t._v(" "),v("td",[t._v("692")]),t._v(" "),v("td",[t._v("163376")]),t._v(" "),v("td",[t._v("최근 4개월")]),t._v(" "),v("td",[t._v("1203ms")]),t._v(" "),v("td",[t._v("5ms")])])])])])]),t._v(" "),v("h6",{attrs:{id:"결론-2"}},[t._v("결론")]),t._v(" "),v("ul",[v("li",[t._v("RDB 대비 월등히 좋은 성능을 보임.")]),t._v(" "),v("li",[t._v("쿼리 시간도 1초 이내로 만족할 만한 시간임.")])])])}),[],!1,null,null,null);_.default=i.exports}}]);