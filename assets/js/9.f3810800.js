(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{191:function(s,t,a){"use strict";a.r(t);var e=a(0),l=Object(e.a)({},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"elasticsearch-세팅-정리"}},[s._v("Elasticsearch 세팅 정리")]),s._v(" "),a("h2",{attrs:{id:"elasticsearch-설치"}},[s._v("Elasticsearch 설치")]),s._v(" "),a("p",[s._v("실행 하기 위해 root 계정 외 다른 계정 사용해야 함."),a("br"),s._v("\njava 8 이상 사용")]),s._v(" "),a("ol",[a("li",[s._v("https://www.elastic.co/downloads/elasticsearch 에서 LINUX용 다운\n"),a("ul",[a("li",[s._v("yum으로 설치 가능하다고 함...!!")])])]),s._v(" "),a("li",[s._v("/home/elasticsearch/ 경로에 복사")]),s._v(" "),a("li",[s._v("tar.gz 압축 풀고")]),s._v(" "),a("li",[a("code",[s._v("/home/elasticsearch/elasticsearch-7.1.1/bin/elasticsearch-env")]),s._v("에 "),a("code",[s._v("JAVA_HOME")]),s._v("을 java8 경로로 변경\n"),a("ul",[a("li",[s._v("tar.gz 압축 풀고 확인해 보면 안에 jdk가 포함되어 있다! 이거 써도 될듯!")])])]),s._v(" "),a("li",[a("code",[s._v("/home/elasticsearch/elasticsearch-7.1.1/bin/elasticsearch")]),s._v("로 실행\n"),a("ul",[a("li",[s._v("응 오류 발생~\n"),a("ol",[a("li",[s._v("[1]: max file descriptors [4096] for elasticsearch process is too low, increase to at least [65535]")]),s._v(" "),a("li",[s._v("[2]: max number of threads [1024] for user [elasticsearch] is too low, increase to at least [4096]")]),s._v(" "),a("li",[s._v("[3]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]")]),s._v(" "),a("li",[s._v("[4]: the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured")])])]),s._v(" "),a("li",[s._v("1, 2번 셋팅\n"),a("ul",[a("li",[s._v("/etc/security/limits.conf 수정")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## config for elasticsearch")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## elasticsearch 유저에게 다음과 같은 권한을 줌.")]),s._v("\nelasticsearch hard memlock unlimited "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 하드 세팅으로 메모리 락 제한 없도록 설정")]),s._v("\nelasticsearch soft memlock unlimited "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 소프트 세팅으로 메모리 락 제한 없도록 설정")]),s._v("\nelasticsearch hard nofile 65536 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 하드 세팅으로 65536개의 파일을 열어볼 수 있게 설정")]),s._v("\nelasticsearch soft nofile 65536 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 소프트 세팅으로 65536개의 파일을 열어볼 수 있게 설정")]),s._v("\nelasticsearch hard nproc 65536 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 하드 세팅으로 65536개의 프로시저를 실행할 수 있게 설정")]),s._v("\nelasticsearch soft nproc 65536 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 소프트 세팅으로 65536개의 프로시저를 실행할 수 있게 설정")]),s._v("\n")])])])]),s._v(" "),a("li",[s._v("3번 셋팅\n"),a("ul",[a("li",[s._v("/etc/sysctl.conf 수정")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# config for elasticsearch")]),s._v("\nvm.max_map_count"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("262144\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 설정 후 리붓")]),s._v("\n")])])])]),s._v(" "),a("li",[s._v("4번 세팅\n"),a("ul",[a("li",[a("code",[s._v("elasticsearch.yml")]),s._v(" 파일 수정\n"),a("ul",[a("li",[s._v("서버 2대로  클러스터 구성\n"),a("ul",[a("li",[s._v("elasticsearch.yml_master_2")]),s._v(" "),a("li",[s._v("elasticsearch.yml_slave_2\n참조.")])])])])])])])])])]),s._v(" "),a("h2",{attrs:{id:"logstash-설치"}},[s._v("LOGSTASH 설치")]),s._v(" "),a("p",[s._v("java 8만 사용"),a("br"),s._v("\n보통 Elastic Search, Logstash, Kibana를 조합하여 사용함."),a("br"),s._v("\n지금은 일단 DB의 데이터를 Elasticsearch에 넣기 위해 Logstash만 사용")]),s._v(" "),a("ul",[a("li",[s._v("https://www.elastic.co/downloads/logstash 에서 LINUX용 다운")]),s._v(" "),a("li",[s._v("/home/elasticsearch/ 경로에 복사")]),s._v(" "),a("li",[s._v("tar.gz 압축 풀고 사용")])]),s._v(" "),a("h3",{attrs:{id:"mariadb-elasticsearch-마이그레이션"}},[s._v("MariaDB -> Elasticsearch 마이그레이션")]),s._v(" "),a("ul",[a("li",[s._v("jdbc 다운로드\n"),a("ul",[a("li",[s._v("LOGSTASH_HOME/bin/logstash-plugin install logstash-input-jdbc")]),s._v(" "),a("li",[s._v("자동 다운, 설치가 안돼서 수동 설치함\n"),a("ul",[a("li",[s._v("다운 경로 : https://rubygems.org/gems/logstash-input-jdbc/versions/4.3.13")]),s._v(" "),a("li",[s._v("설치 : "),a("code",[s._v("LOGSTASH_HOME/bin/logstash-plugin install FILE_PATH/logstash-input-jdbc-4.3.13.gem")])])])])])]),s._v(" "),a("li",[s._v("config 설정(사용 목적에 따라 다양하게 작성하여 사용)\n"),a("ul",[a("li",[a("code",[s._v("mysql_to_elasticsearch_conf_file.conf")]),s._v(" 참조.`")])])])]),s._v(" "),a("h2",{attrs:{id:"사용법"}},[s._v("사용법")]),s._v(" "),a("h3",{attrs:{id:"데이터-집어넣기"}},[s._v("데이터 집어넣기")]),s._v(" "),a("ol",[a("li",[s._v("curl 써서 put으로"),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("curl -XPUT -H 'Content-Type: application/json' 'http://10.10.0.41:9200/my_index/my_type/384279?pretty' -d @./my_data.json\n")])])])]),s._v(" "),a("li",[s._v("curl 사용 bulk insert\n"),a("ul",[a("li",[a("code",[s._v("curl -XPOST -H 'Content-Type: application/json' 'http://10.10.0.41:9200/my_index/_bulk' --data-binary @my_data_cnt_10000.txt")])]),s._v(" "),a("li",[s._v("파일 형식은"),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"index"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_type"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my_type_name"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"key1"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"key2"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n...\n")])])]),a("ul",[a("li",[a("code",[s._v('sed \'a\\\\{ "index" : { "_type" : "component" }}\' output.txt > output2.txt')])])])])])]),s._v(" "),a("li",[s._v("Logstash 사용\n"),a("ul",[a("li",[s._v("MariaDB -> Elasticsearch 를 위한 logstash config 파일(mysql 도 동일)\n"),a("ul",[a("li",[a("code",[s._v("mysql_to_elasticsearch_conf_file.conf")]),s._v(" 참조.")])])]),s._v(" "),a("li",[s._v("csv파일 -> Elasticsearch 를 위한 logstash config 파일\n"),a("ul",[a("li",[a("code",[s._v("csv_to_json.conf")]),s._v(" 참조")])])]),s._v(" "),a("li",[s._v("실행\n"),a("ul",[a("li",[a("code",[s._v("/home/elasticsearch/logstash/bin/logstash -f /home/elasticsearch/logstash/config/mysql_to_elasticsearch_conf_file.conf")])]),s._v(" "),a("li",[a("code",[s._v("-f")]),s._v(" 옵션을 주고 뒤에 conf파일을 명시하면 그 파일 기준으로 실행됨")]),s._v(" "),a("li",[a("code",[s._v("-f")]),s._v(" 옵션 없이 "),a("code",[s._v("logstash")]),s._v("만 실행하면 "),a("code",[s._v("pipeline.yml")]),s._v("을 참조하여 실행됨.")])])])])]),s._v(" "),a("li",[s._v("binary log 사용하여 실시간 동기화\n"),a("ul",[a("li",[s._v("해봐야 함.")])])])])])},[],!1,null,null,null);t.default=l.exports}}]);